<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Result - Bandwidth Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <style>
        body > main { padding: 2rem; max-width: 1200px; }
        nav { margin-bottom: 2rem; }
        .error { background-color: var(--pico-form-element-invalid-background-color); color: var(--pico-form-element-invalid-color); padding: 1rem; border-radius: var(--pico-border-radius); white-space: pre-wrap; word-wrap: break-word; }
        .highlight { background-color: var(--pico-color-green-100); }
        .timeline { list-style-type: none; padding-left: 0; }
        .timeline li { padding-left: 2rem; border-left: 3px solid var(--pico-primary); position: relative; padding-bottom: 1.5rem; margin-left: 1rem; }
        .timeline li::before { content: '✓'; position: absolute; left: -12px; top: 0; background: var(--pico-primary); color: white; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; }
        .sent { color: var(--pico-color-azure-600); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        pre { background-color: #f5f5f5; padding: 1rem; border-radius: var(--pico-border-radius); white-space: pre-wrap; word-wrap: break-word; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); grid-gap: 2rem; }
    </style>
</head>
<body>
<main class="container">
    <nav>
        <ul><li><strong>Bandwidth Tools</strong></li></ul>
        <ul>
            <li><a href="/">Dashboard</a></li>
        </ul>
    </nav>
    <article>
        {# --- DLR TEST RESULT --- #}
        {% if result_type == 'dlr' %}
            <h2>Test Result</h2>
            {% if error %}
                <p class="error"><strong>Error:</strong><br>{{ error }}</p>
            {% elif status == 'sent' %}
                <h3 class="sent">✅ MMS Sent Successfully!</h3>
                <p><strong>Message ID:</strong> {{ message_id }}</p><hr>
                <p><strong>Note:</strong> A 'message-delivered' report was not received within the 60-second timeout.</p>
            {% else %}
                <h3>DLR Timeline</h3>
                <ul class="timeline">
                    <li><strong>Message Sent to API</strong><br>Timestamp: {{ events.get('sent_str', 'N/A') }}</li>
                    {% if events.sending %}<li><strong>Sent to Carrier</strong> (Leg 1 Latency: {{ "%.2f"|format(events.sending_latency) }}s)<br>Timestamp: {{ events.get('sending_str', 'N/A') }}</li>{% endif %}
                    {% if events.delivered %}<li><strong>Delivered to Handset</strong> (Leg 2 Latency: {{ "%.2f"|format(events.delivered_latency) }}s)<br>Timestamp: {{ events.get('delivered_str', 'N/A') }}</li>{% endif %}
                </ul><hr>
                <h4>Total End-to-End Latency: {{ "%.2f"|format(events.total_latency) }} seconds</h4>
                <p><strong>Message ID:</strong> {{ message_id }}</p>
            {% endif %}<br><a href="/" role="button" class="secondary">Back to Dashboard</a>

        {# --- BULK TEST RESULT --- #}
        {% elif result_type == 'bulk' %}
            <div id="results-article"><hgroup><h2>Bulk Test Results</h2><p id="status-text">Tests in progress...</p></hgroup><div class="loader" id="loader"></div><div class="grid"><div id="sms-10dlc-results" style="display:none;"><h3>SMS Results (10DLC)</h3><figure><table id="sms-10dlc-table"></table></figure></div><div id="sms-tf-results" style="display:none;"><h3>SMS Results (Toll-Free)</h3><figure><table id="sms-tf-table"></table></figure></div></div><div class="grid"><div id="mms-10dlc-results" style="display:none;"><h3>MMS Results (10DLC)</h3><figure><table id="mms-10dlc-table"></table></figure></div><div id="mms-tf-results" style="display:none;"><h3>MMS Results (Toll-Free)</h3><figure><table id="mms-tf-table"></table></figure></div></div><br><a href="/" role="button" class="secondary">Back to Dashboard</a></div>
            <script>
                // ... (JavaScript for bulk results is unchanged) ...
            </script>
        
        {# --- ANALYSIS RESULT --- #}
        {% elif result_type == 'analysis' %}
            <div id="results-article"><hgroup><h2>Analysis Report</h2><p id="status-text">Analysis in progress...</p></hgroup><div class="loader" id="loader"></div><div id="analysis-content" style="display:none;"></div></div>
            <script>
                // ... (JavaScript for analysis results is unchanged) ...
            </script>
        {% endif %}
    </article>
</main>
</body>
</html>
